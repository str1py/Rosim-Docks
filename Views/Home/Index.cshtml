@using Microsoft.EntityFrameworkCore;
@using RosreestDocks.Contexts
@using System;
@inject DataBaseContext db
@{
    ViewData["Title"] = "Home Page";
    var newlist = db.Request.Include(a => a.Status).Where(x => x.DockType.Id == 1).Where(x => x.Status.Id != 5).OrderBy(o => o.DocName).ToList(); // Н/А
    var letterlist = db.Request.Include(a => a.Status).Where(x => x.DockType.Id == 2).Where(x => x.Status.Id != 5).OrderBy(o => o.DocName).ToList(); //письмо
    var zaproslist = db.Request.Include(a => a.Status).Where(x=>x.DockType.Id == 3).Where(x => x.Status.Id != 5).OrderBy(o=>o.DocName).ToList(); //запрос ЦА 
    var rasporlist = db.Request.Include(a => a.Status).Include(a=>a.RecipientAgency).Include(a=>a.TransferAgency)
                    .Where(x=>x.DockType.Id == 4 || x.DockType.Id == 5).Where(x => x.Status.Id != 5)
                    .OrderBy(o=>o.DocName).OrderBy(o=>o.Status).ToList(); //распоряжения

    var notes = db.Notes.Include(x=>x.Importance).ToList();


    string GetName(AgencyModel agency)
    {
        if(String.IsNullOrEmpty(agency.ShortName))
            return agency.Name;
        else return agency.ShortName;
    }
}


<div class="container-flex" style="margin-bottom:50px;">
    <div class="row">
        <div class="col-12">
            <div style="display:flex;">
                <h3 class="h3_index item"><i class="fas fa-sticky-note"></i>Заметки</h3>
                <button type="button" style="background-color:transparent; border:0px;" data-toggle="modal" data-target="#exampleModal">
                    <i style="margin-left:10px;" class="fas fa-plus-circle main-blue"></i>
                </button>
            </div>            
                 <details>
                    <summary>Подробнее</summary> 
                    <div class="container-flex" style="margin-top:10px;">
                        <div class="row">
                    @{
                    foreach(var note in notes)
                        {
                        var color = "";
                        if (note.Importance.Id == 1) color = "blue";
                        else if (note.Importance.Id == 2) color = "orange";
                        else color = "red";

                            <div class="col-4">
                                <div class="box @color">
                                    <div class="box-top">
                                       <h5 class="item">@note.Name</h5> 
                                       <button  type="button" class="btn btn-success seccbut item" data-toggle="modal" data-target="#completeModal" 
                                                data-name="@note.Name" data-id="@note.Id"><i class="far fa-check-circle"></i></button>

                                    </div>
                                    <p>@note.Text</p>
                                </div>
                            </div>

                        }
                    }
                        </div>
                    </div>
                </details>
        </div>
    </div>
</div>

<div class="container-flex">
    <div class="row">
        <div class="col-4">
            <h3 class="h3_index"><i class="fas fa-exclamation-triangle"></i>Без ответа  <span class="badge rounded-pill badge-notification bg-primary text-white">@newlist.Count()</span></h3>
            <details>
                <summary>Подробнее</summary> 
                <table class="table table-sm table-hover">
                    <thead>
                        <tr>
                            <th scope="col" style="width:20%;">#</th>        
                            <th scope="col" style="width:20%;">Статус</th>   
                            <th scope="col" style="width:25%;">ВР</th>   
                            <th scope="col" style="width:35%;">Отправленный</th>
                        </tr>
                    </thead>
                <tbody>
                           @{foreach(var a in newlist) {
                           <tr>
                               <td> <a href="/data/editappealconsider/@a.Id">@a.DocName</a> </td>
                               <td>@a.Status.Name</td>
                               <td>@a.WorkNumber</td>
                               <td>@a.SendNumber</td>
                           </tr>
                           } }              
                </tbody>
                </table>
            </details>
        </div>
        <div class="col-4">
            <h3 class="h3_index"><i class="fas fa-envelope"></i>Письма  <span class="badge rounded-pill badge-notification bg-primary text-white">@letterlist.Count()</span> </h3>
            <details>
                <summary>Подробнее</summary> 
                <table class="table table-sm table-hover">
                    <thead>
                        <tr>
                            <th scope="col" style="width:20%;">#</th>        
                            <th scope="col" style="width:20%;">Статус</th>   
                            <th scope="col" style="width:25%;">ВР</th>   
                            <th scope="col" style="width:35%;">Отправленный</th>
                        </tr>
                    </thead>
                    <tbody>
                               @{foreach(var a in letterlist) {
                               <tr>
                                   <td> <a href="/data/editappealconsider/@a.Id">@a.DocName</a> </td>
                                   <td>@a.Status.Name</td>
                                   <td>@a.WorkNumber</td>
                                   <td>@a.SendNumber</td>
                               </tr>
                               } }              
                    </tbody>
                </table>
            </details>
        </div>
        <div class="col-4">
            <h3 class="h3_index"><i class="fas fa-sync"></i>Запросы ЦА  <span class="badge rounded-pill badge-notification bg-primary text-white">@zaproslist.Count()</span></h3>
            <details>
                <summary>Подробнее</summary> 
                <table class="table table-sm table-hover">
                    <thead>
                        <tr>
                            <th scope="col" style="width:20%;">#</th>        
                            <th scope="col" style="width:20%;">Статус</th>   
                            <th scope="col" style="width:25%;">ВР</th>   
                            <th scope="col" style="width:35%;">Отправленный</th>
                        </tr>
                    </thead>
                    <tbody>
                               @{foreach(var a in zaproslist) {
                               <tr>
                                   <td> <a href="/data/editappealconsider/@a.Id">@a.DocName</a> </td>
                                   <td>@a.Status.Name</td>
                                   <td>@a.WorkNumber</td>
                                   <td>@a.SendNumber</td>
                               </tr>
                               } }              
                    </tbody>
                </table>
            </details>
        </div>
    </div>

    <div class="row" style="margin-top:50px;">
        <div class="col-12">
            <h3 class="h3_index"><i class="fas fa-scroll"></i>Распоряжения  <span  class="badge rounded-pill badge-notification bg-primary text-white">@rasporlist.Count()</span></h3>
            <details>
                <summary>Подробнее</summary> 
                <table class="table table-sm table-hover">
                    <thead>
                        <tr>
                            <th scope="col" style="width:5%;">#</th> 
                            <th scope="col" style="width:50%;">Организации</th>  
                            <th scope="col" style="width:10%;">Статус</th>   
                            <th scope="col" style="width:10%;">ВР</th>   
                            <th scope="col" style="width:15%;">Распоряжение</th>
                            <th scope="col" style="width:10%;">Cопровод</th>
                        </tr>
                    </thead>
                <tbody>
                           @{
                            foreach(var a in rasporlist) {
                            <tr>
                               <td> <a href="/data/editappealconsider/@a.Id">@a.DocName</a> </td>
                               <td style="font-size:9px;">@GetName(a.TransferAgency) <br> ------- <br>  @GetName(a.RecipientAgency)</td>
                               <td>@a.Status.Name</td>
                               <td>@a.WorkNumber</td>
                               <td>@a.SendNumber</td>
                               <td>@a.SoprovodNumber</td>
                           </tr>
                           } }              
                </tbody>
                </table>
            </details>
        </div>
    </div>
</div>



<script src="~/js/jquery.min.js"></script>


<!-- Modal -->
<div class="modal fade" id="completeModal" tabindex="-1" role="dialog" aria-labelledby="completeModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="completeModalLabel"></h5>
          </div>
          <input type="hidden" id="noteid"/>
          <div class="modal-footer">
          <input type="submit"  class="btn btn-primary button-main"  onclick="RemoveNote()" value="Ну типа"/>
        </div>
    </div>
    </div>
</div>


@using RosreestDocks.Helpers
@{
    NoteModel notemodel = new();
    notemodel.ImportanceList = db.Importance.ToSelectListItem(null);
}

@await Html.PartialAsync("/Views/Data/Modal/Partial/_AddNoteModal.cshtml",notemodel)